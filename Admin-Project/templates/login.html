<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login</title>
<link rel="stylesheet" href=" {{ url_for('static', filename='login.css') }} ">

    <!-- BOOTSTRAP CSS FILE -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- AOS CSS FILE -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

</head>
<body>
<canvas id="gl"></canvas>


<!-- ALERT TOAST BUTTON -->
<div id="toast"></div>


<!-- NAVBAR -->
<nav class="navbar navbar-dark navbar-expand-md">
    <div class="container-fluid p-0">

        <a href="/home" data-aos="fade-down" data-aos-duration="500" class="logo ms-3" >Anuj</a>


        <button class="navbar-toggler me-3"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navLinks">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navLinks">
            <ul class="navbar-nav ms-auto text-center me-3 ">
                <li data-aos="fade-down" data-aos-duration="1000" class="nav-item"> <a href="/home" class="nav-link me-5">Home</a></li>
                <li data-aos="fade-down" data-aos-duration="1500" class="nav-item"> <a href="/about" class="nav-link me-5">About</a></li>
                <li data-aos="fade-down" data-aos-duration="2000" class="nav-item"> <a href="/projects-view " class="nav-link me-5">Projects</a></li>
                <li data-aos="fade-down" data-aos-duration="2500" class="nav-item"> <a href="/education" class="nav-link me-5">Education</a></li>
                <li data-aos="fade-down" data-aos-duration="3000" class="nav-item"> <a href="/contact" class="nav-link me-5">Contact</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- ===== ONLY ADDITION START ===== -->
<div class="auth-layout">
<!-- ===== ONLY ADDITION END ===== -->

<div class="container" data-aos="flip-left"
     data-aos-easing="ease-out-cubic"
     data-aos-duration="2000" >

    <h2>Admin Login</h2>
    <hr>
    <div class="holders">
        <placeholder> Email:</placeholder><br>
        <input id="email" placeholder="Email"><br>

        <placeholder> Password:</placeholder><br>
        <input id="password" type="password" placeholder="Password">

        <button id="loginBtn" type="button">Send OTP</button>
        <div id="timer" class="hidden">
            Resend OTP in <span id="time">300</span>s
        </div>


        <div id="otpBox" class="hidden">
            <input id="otp" placeholder="Enter OTP">
            <button onclick="verify()">Verify OTP</button>
        </div>
    </div>

</div>




<script>
let timerInterval = null;

function startTimer(seconds, btn) {
    const timer = document.getElementById("timer");
    const time = document.getElementById("time");

    timer.classList.remove("hidden");
    btn.textContent = "OTP Sent";

    let remaining = seconds;
    time.textContent = remaining;

    const interval = setInterval(() => {
        remaining--;
        time.textContent = remaining;

        if (remaining <= 0) {
            clearInterval(interval);
            timer.classList.add("hidden");
            btn.disabled = false;
            btn.textContent = "Resend OTP";
            otpLocked = false;
        }
    }, 1000);
}




// ================Login Button ==================

const loginBtn = document.getElementById("loginBtn");
let otpLocked = false;

loginBtn.addEventListener("click", function () {
    if (otpLocked) return;   // block extra clicks immediately

    otpLocked = true;
    loginBtn.disabled = true;
    loginBtn.textContent = "Sending OTP...";

    fetch("/login", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
            email: email.value,
            password: password.value
        })
    })
    .then(r => r.json())
    .then(d => {
        if (d.otp) {
            showToast("OTP sent to your email", "success");
            document.getElementById("otpBox").classList.remove("hidden");
            startTimer(300, loginBtn);
        } else {
            otpLocked = false;
            loginBtn.disabled = false;
            loginBtn.textContent = "Send OTP";
            showToast(d.error || "Login failed", "error");
        }
    })
    .catch(() => {
        otpLocked = false;
        loginBtn.disabled = false;
        loginBtn.textContent = "Send OTP";
        showToast("Server error", "error");
    });
});





function verify() {
    fetch("/verify-otp", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ otp: otp.value })
    })
    .then(r => r.json())
    .then(d => {
        if (d.success) {
            showToast("Login successful", "success");
            setTimeout(() => location.href = "/admin", 800);
        } else {
            showToast(d.error || "Invalid OTP", "error");
        }
    });
}
</script>




</script>
<script src="{{ url_for('static', filename='video-hover.js') }}"></script>

    <!-- BOOTSTRAP SCRIPT FILE -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- AOS SCRIPT FILE -->
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>


  <!-- TOAST MESSAGE  FILE -->
  <script src="{{ url_for('static', filename='toast.js') }}"></script>

  <script>
    AOS.init();
  </script>
</body>
</html>
