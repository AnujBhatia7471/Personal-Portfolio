<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Me</title>

    
    <!-- BOOTSTRAP CSS FILE -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- AOS CSS FILE -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

    <link rel="stylesheet" href="{{ url_for('static', filename='contact2.css') }}">


</head>
<body>
<canvas id="gl"></canvas>

<!-- NAVBAR -->
<nav class="navbar navbar-dark navbar-expand-md">
    <div class="container-fluid p-0">

        <a href="/home" data-aos="fade-down" data-aos-duration="500" class="logo ms-3">Anuj</a>

        <button class="navbar-toggler me-3"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navLinks">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navLinks">
            <ul class="navbar-nav ms-auto text-center me-3 ">
                <li data-aos="fade-down" data-aos-duration="1000" class="nav-item"> <a href="/home" class="nav-link me-5">Home</a></li>
                <li data-aos="fade-down" data-aos-duration="1500" class="nav-item"> <a href="/about" class="nav-link  me-5">About</a></li>
                <li data-aos="fade-down" data-aos-duration="2000" class="nav-item"> <a href="/projects-view" class="nav-link  me-5">Projects</a></li>
                <li data-aos="fade-down" data-aos-duration="2500" class="nav-item"> <a href="/education" class="nav-link me-5">Education</a></li>
                <li data-aos="fade-down" data-aos-duration="2500" class="nav-item"> <a href="/contact" class="nav-link me-5" style=" color: #38bdf8 !important;" >Contact</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="div1">
    <div class="a1">
        <h1 class="contactus" data-aos="fade-down" data-aos-duration="1500" >CONTACT <span class="us">ME</span></h1>
    </div>
</div>

<div class="container" data-aos="flip-left"
     data-aos-easing="ease-out-cubic"
     data-aos-duration="2000" >
    
    
        <form id="contactForm">
         <div class="A">

            <label for="name">Name:</label><br>
            <input type="text" id="name" name="name" required>
            <br><br>

            <label for="email">Email:</label><br>
            <input type="email" id="email" name="email" required>
            <button type="button" id="verifyBtn" class="button">Verify Email</button>
            <div id="otpBox">
                <input type="text" id="otp" placeholder="Enter OTP" style="background: white !important;">
                <button type="button" id="otpBtn" class="button">Verify OTP</button>
                <div id="timer"></div>
            </div>

            <br><br>

            <label for="message">Message:</label><br>
            <textarea id="message" name="message" placeholder="Drop your message here..." required></textarea>
            <br>

            <button class="button" id="sendBtn" type="submit">Send</button>

            <br><br>
        </div>
    </form>
</div>


<div class="btn-box" data-aos="fade-up"
     data-aos-anchor-placement="center-bottom" data-aos-duration="2000" >
        <a href="/home" class="home-button">HOME</a>
</div>


<script src="{{ url_for('static', filename='hover.js') }}"></script>


    <!-- BOOTSTRAP SCRIPT FILE -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- AOS SCRIPT FILE -->
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  <script>
    AOS.init();
  </script>

<script>
let timer = 60;
let interval;
let emailVerified = false;

const verifyBtn = document.getElementById("verifyBtn");
const otpBox = document.getElementById("otpBox");
const otpBtn = document.getElementById("otpBtn");
const sendBtn = document.getElementById("sendBtn");
const timerText = document.getElementById("timer");

verifyBtn.onclick = async () => {
    const email = document.getElementById("email").value;
    if (!email) {
    showToast("Please enter your email");
    return;
}

    verifyBtn.innerText = "Sending OTP...";
    verifyBtn.disabled = true;

    await fetch("/contact/send-otp", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({email})
    });

    showToast("OTP sent successfully");
    otpBox.style.display = "block";
    startTimer();
};

otpBtn.onclick = async () => {
    const email = document.getElementById("email").value;
    const otp = document.getElementById("otp").value;

    const res = await fetch("/contact/verify-otp", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({email, otp})
    });

    const data = await res.json();

    if (data.success) {
    showToast("Email verified");

    emailVerified = true;   // <-- THIS LINE
    otpBox.style.display = "none";

    clearInterval(interval);
    timerText.innerText = "";

    verifyBtn.disabled = false;
    verifyBtn.innerText = "Verify Again";
}


};

document.getElementById("contactForm").onsubmit = async (e) => {
    e.preventDefault();

    if (!emailVerified) {
        showToast("Please verify your email first");
        return;
    }

    const payload = {
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    message: document.getElementById("message").value
};
console.log("Sending payload", payload);

    sendBtn.innerText = "Sending...";
    sendBtn.disabled = true;

    const res = await fetch("/contact/send-message", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    });

        const data = await res.json();

    if (data.success) {
        sendBtn.innerText = "Email Sent";
        showToast("Message sent successfully");

        setTimeout(() => {
            window.location.href = "/";
        }, 1500);
    } else {
        sendBtn.innerText = "Send";
        showToast("Failed to send message");
    }
};


function startTimer() {
    timer = 60;
    timerText.innerText = "Resend in 60s";

    interval = setInterval(() => {
        timer--;
        timerText.innerText = "Resend in " + timer + "s";

        if (timer <= 0) {
            clearInterval(interval);
            verifyBtn.disabled = false;
            verifyBtn.innerText = "Resend OTP";
            timerText.innerText = "";
        }
    }, 1000);
}

function showToast(msg) {
    const t = document.createElement("div");
    t.className = "toast-msg";
    t.innerText = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 3000);
}
</script>


</body>
</html>
